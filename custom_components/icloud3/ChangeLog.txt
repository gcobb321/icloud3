### Important Links:
**Migrating from v2.4.7_** - See [here](https://gcobb321.github.io/icloud3_v3_docs/#/chapters/3.1-migrating-v2-to-v3) for instructions on migrating from from an older version.
**Installing for the first time_** - See [here](https://gcobb321.github.io/icloud3_v3_docs/#/chapters/3.2-installing-and-configuring) for instructions on installing as a New Installation
**iCloud3 v3 Documentation** - iCloud3 User Guide can be found [here](https://gcobb321.github.io/icloud3_v3_docs/#/)

3.1.4
.......................
### Release Notes - v3.1.4 (12/24/2024)
1. APPLE ACCOUNT PASSWORD AUTHENTICATION:
    - Reverted back to the old password authentication protocol before the Secure Remote Password (SRP) protocol was implemented
    - The Password SRP protocol will be tried if the old password authentication protocol fails.
2. ADD ICLOUD3 DEVICE SCREEN (Redesign) - Redesigned the screen so the basic tracking parameters (iCloud & Mobile App devices and picture) are selected on this screen instead of the Update Device screen.
3. UPDATE DEVICE SCREEN (Redesign) - The rarely used fields (inZone & Fixed Interval, Track from Zone, etc) are not displayed if they are using the default values. A check box is enabled to display these fields.
4. TOOLS SCREEN (New Feature) - A `Tools` screen replaces the `Actions` screen on the Configure Menu screen. This is used for configuration file maintenance to reset all Devices Apple Account fields, Delete all Apple Accounts and Devices, Delete all iCloud3 and Apple Account cookie files, etc.
5. STARTUP (Improved) - Error and warning messages have been improved when setting up Apple Accounts and the Mobile App devices. When errors are encountered (devices can not be found, invalid Apple Account information, etc), an attempt will be made to correct the error using known device names and identification codes. Sometimes it works, sometimes it doesn't and the configuration will need to be updated.
6. ERROR & WARNING MESSAGES (Improved) - Changed various messages to improve readability and simplify the text.
7. MISCELLANEOUS CHANGES - A lot of internal code changes to make messages consistant, alerts all the same format with the samt highlight icons, improve code maintenance and to remove dead code and more.

What's Next:
.......................
1. YubiKey support.
2. Implementation of the Password SRP protocol as the primary method of authentication passwords. It works but asks for the 6-digit verification code constantly. I have things to try but it will need long-term testing to insure the verification code request is minimized.
3. There are times when HA adds a `_2` extension to the device_tracker and sensor entity name when HA is reloaded and the iCloud3 integration is still running. A new Tool will be developed to easily reset these entity names to their correct name without the `_2`.




3.1.2
.......................
### Change Log - v3.1.2
1. INITIAL SETUP (Fixed) - This fixed some issues related an initial install where there are no apple accounts or where the iCloud3 Apple account's first configuration file entry was blank.. This fixes the error message:
    ```
    File "/config/custom_components/icloud3/config_flow.py", line 1974,
        in async_step_update_apple_acct
    self._update_conf_apple_accounts(self.aa_idx, user_input)
    File "/config/custom_components/icloud3/config_flow.py", line 2055,
        in _update_conf_apple_accounts
    if Gb.conf_apple_accounts[0][CONF_USERNAME] == '':
    ~~~~~~~~~~~~~~~~~~~~~~^^^
    IndexError: list index out of range
    ```



3.1.1
.......................
### Change Log - v3.1.1
1. LOCATING DEVICES:
    - Added additional checks to insure the Apple Account location data was refreshed during startup and while configuing iCloud3 settings. Fixed a problem where the location information data from Apple was not being initialized properly.
    - Fixed the location refresh not being done that caused the '0 of 0' to be displayed in the Configure Setting screens, leading to the Apple Account selection lists to not be populated.
    - Fixed some problems where 'Locate All Devices = False' would still locate all the devices in the Apple account
    - Added error checking to make sure the Locate All Devices can not be disabled if there were Family devices that
    were assigned to that Apple account. If it was disabled, they would never be located.
2. UPDATE DEVICE SCREEN - Added (and fixed) the TOOLS - RESET DATA SOURCE(S), DELETE DEVICE(S) option where you can reset the device's Apple Account and Mobile App to default values (None) and fixed a problem deleting devices. Reworked the Apple Account selection list to provide more information and identify setup errors.
3. UPDATE APPLE ACCOUNT USERNAME/PASSWORD SCREEN - Added checks to insure Locating All Devices can not be disabled if there are tracked devices assigned to this account that are in the Family list.
4. OTHER THINGS - Changed several things under the covers.


3.1
.......................
### Change Log - v3.1
1. APPLE ACCOUNT LOGIN (Fixed) - Apple changed the method of logging into the Apple Account to use Secure Remote Password verification where a hash-key is calculated from the password by both iCloud3 and Apple. The hash-key, instead of the password, is sent over the internet. Apple then compares the hash-key sent by iCloud3 to it's hash-key to determine the validity of the password. Note: In a few cases, the hash-key algorithm used by iCloud3 may not be the same as Apple for a valid password and you will need to change your password.
1. MULTIPLE APPLE ACCOUNTS (New) - iCloud3 now supports tracking devices from more than one Apple Account. The accounts are setup on the 'Configuration > Data Sources' screen and devices can be tracked from any apple account and the d if the device is set up as an account owners deviceThe Primary account belongs to the person with the main Family Sharing list as it always has. Secondary accounts can also be configured and devices from those accounts can be tracked. The Apple Account for the specific iCloud3 device is selected on the Update Devices screen as it always has.
2. FAMSHR - Everything called FamShr has been changed to iCloud.
2. THE APPLE ACCOUNT (Improved) - Logging into the Apple Account is now started before the beginning the HA process that creates the device_tracker and sensor entities. Both processes now run concurrently, eliminating (or reducing) any delays waiting for the Apple Account device data to be returned. The result is iCloud3 starts up faster.
3. APPLE ACCOUNT & MOBILE APP DEVICE ASSIGNMENT (Improved) - The results of matching the Apple Account iCloud devices and the Mobile App devices during startup are displayed in the Event Log. This has been simplified and is easier to read.
4. CONFIGURATION SCREENS (Improved) -
    - Saving changes is faster.
    - The iCloud3 Devices screen indicates if there is a problem with the iCloud or Mobile App device selection.
    - Update Devices screen - Impoved selection of Apple Account and Mobile App devices.
5. MISSING APPLE ACCOUNT DEVICES (Improved) - Sometimes, an iCloud device's information is not returned from iCloud when iCloud3 starts. The error recovery and data request retry routines have been rewritten to only retry setting up devices with the error. This greatly simplifies and reduces the steps needed to retrieve the data from iCloud.
6. WAZE & WAZE HISTORY (Improved) - Improved the error checking, added retry on error conditions and updated the History database recalculation routines to better support concurrent operations.
7. APPLE ACCOUNT DEVICE STARTUP ERRORS (Enhanced) - Improved the handling and reporting duplicate and missing Apple Account devices.
8 STARTING/RESTARTING ICLOUD3 -
    - Device Sensors (Fixed) - They were being reinitialized when Restarting iCloud3 when they shouldn't have been.
    - Mobile App entities (Fixed) - They are no longer being reinitialized when iCloud3 is restarted on a configuration change or Event Log restart request. This includes the device_tracker, battery, trigger and notify entities..
    - Improved messaging and fixed miscellaneous bugs



3.0.5.2
.......................
### Change Log - v3.0.5.2 (6/8/2024)
1. HA I/O ERROR FROM EVENT LOOP (Fixed) - HA was complaining about doing I/O (HACS file) outside of the Event Loop. Changed the method of doing I/O to use HA routines for the configuration file, restore state file and HACS file.
2. FROM_ZONE ERROR (Fixed) - Normally the TrackFrom Zone and NextUpdate Zone is the Home zone. Added a check to set it to Home if it had never been set.


3.0.5.1
.......................
### Change Log - v3.0.5.1 (5/25/2024)
1. MOBILE APP (Fix) - Fixed a problem where the device's Mobile App data source would be disabled (reset to NotUsed) if the HA Mobile App Integration was set up after the Mobile App's initial locate had been completed.
2. TRANSLATION FILE (new) - Added Chinese (Simplified) translation (@MagicStarTrace)

### Change Log - v3.0.5 (5/18/2024)
1. HACS UPUDATE ALERT (New) - The HACS Integration information will be check on a regular basis to see if a newer version of iCloud3 is available.
2. ICLOUD ACCOUNT AUTHENTICATION/FAMSHR DEVICES LIST (Fixed) - During startup ("Stage 4), the iCloud Account access is set up and the devices in the Family Sharing List is read. If a problem occurred, iCloud3 would retry this 10-times to see if the error was corrected. However, the iCloud data was not being reread and the old data was being used. The iCloud data is now reread correctly when trying to recover from this error.
3. UPDATE DEVICES SCREEN (Fixed) - When upgrading a device (iPhone, iPad, Watch) and both the old and new devices are still in the Family Sharing List, the new device was being set back to the old device the next time iCloud3 was started.
4. LOCKED ICLOUD ACCOUNT (New) - An error message is displayed in the HA logs and on the Event Log if the iCloud account is locked.
5. EVENT LOG (Fix) - An 'Unbound event_recd' error would display when the length of the the event text > 2000 characters (@ehendrix23).


v3.0.4
.......................
### Change Log - v3.0.4 (5/11/2024)
1. ADD DEVICE (Fixed) - An 'Out of Range' error message was encountered adding the first device.
2. DIRECTION OF TRAVEL (Improvement) - Tweaked the AwayFrom direction override when approaching Home after the previous directions were Towards.
3. Event Type DEPRECIATED EOORO MESSAGE (Fixed) - This was a warning about the removal of the EventType from HA next year. It has been removed.
4. RAWDATA LOGGING - Changed some formatting of the log to better filter device messages.


v3.0.3
.......................
### Change Log - v3.0.3 (5/1/2024)
1. ALERTS (New) - An alert message is displayed on the Event Log and in the _alert_ attribute on the device's device_tracker and badge entities until it has been resolved. Examples of alerts are a startup error, no gps data, the device is offline, the battery below 20%, and tracking is paused. The alert attribute can be used in an automation to trigger sending a message to any device using the Mobile App. See the _Reference > Devices and Other Alerts_ chapter in the iCloud3 docs [here](#/chapters/7.6-alerts) for more information and example automations.
2. BATTERY (Improvement) - The battery information attribute has been added to the device's device_tracker and badge entity. It shows the battery level, charging state, when the information was updated and the source of the data. The charging status text has been changed to 'Charged', 'Charging', 'NotCharging', 'Low' and 'Unknown'.
3. UPDATE SENSOR (Fixed) - An 'AttributeError' message has been fixed. It was caused by trying to update the sensor before the sensor had been set up.
4. CONFIGURE SETTINGS > ICLOUD ACCOUNT AND MOBILE APP screen (Fixed) - Changing iCloud account information (Username or password) was not being saved correctly so restarting iCloud3 would still use the old account. A Log Off option was added to initialize the iCloud Account username/password fields.
5. DIRECTION OF TRAVEL (Improvement) - When Driving towards Home, the calculated straight line distance is used to determine the travel direction ('Towards'). The direction would momentarily  change to 'AwayFrom' if the distance from Home increased due to a curve in the road or you were stopped at an intersection. It would then change back to 'Towards' on the next update. In this case, the direction will not be changed and will remain 'Towards'.
6. Other minor code changes, tuning and code cleanup.



v3.0.2 - 3/30/2023
.......................
1. ICLOUD SERVER ERROR MESSAGE (Fixed) - When the iCloud servers did not respond with location information, the 'no response from iCloud servers' error was displayed correctly. This was followed by another unrelated error which should have not been displayed.
2. ALERTS, STARTUP ERRORS, WARNING MESSAGES (New) - Unusual errors or warning events for iPhones, iPads, and Watches are displayed in a green bar on the first line of the Event Log whenthe event occurs. The message will continue displaying until the event is corrected. This includes (1) startup errors, (2) no data received from iCloud Location Servers, (3) when a device is offline and (4) when a device's location is over 5-hours old and (5) when tracking is paused. The messages from AirPods and iPods are only displayed when their Event Log screen is displayed.
3. OTHER - Minor code corrections and cleanup.

v3.0.1.1 - 3/24/2024
.......................
1. ICLOUD-0.LOG FILE (Fixed) - The icloud-0.log file was not being created when the HA 'logger:' statement was not in the HA configuration.yaml file.

v3.0.1 - 3/20/2024
.......................
1. UPDATE SENSOR & DEVICE TRACKER ENTITIES (Improvement) - Changed the method of updating these items at the request of @balloob (Paulus Schousten, HA Founder) to prevent a potential Home Assistant lockup when doing an update.
2. LOG FILE (Improvement) - Changed the method of updating the iCloud3 log files. Also changed some of the record formatting to improve readability.
2. WAZE & CALC DISTANCE SENSORS (Fixed) - They were not being created.
3. UPDATE DEVICES CONFIGURE SCREEN (Fixed) - The Picture parameter was listing every image file in the all of the www/ sub-directories. A filter was added to limit the search to specific directories. The filter is defined on the Tracking and Other Parameters screen. Only the first 25 image files in a directory will be displayed to prevent overloading the HA dropdown list handler.
4. FIXED INTERVAL (Improvement) - The lowest interval was reduced from 5-minutes to 3-minutes.
5. DIRECTION OF TRAVEL (Improvement) - Changed the way this is being updated. If the distance from Home is more than 400m/250mi, it will be set to FarAway.
6. STATIONARY ZONE (Fixed) - The second device to enter an existing Stationary Zone was not saving the Stationary Zone info correctly.
